concord-agent {
  capabilities = {
    flavor: "kubernetes"
    k8s: {
      namespace: "{{ .Values.namespace }}"
    }
  }

  workersCount = {{ .Values.agent.workers }}

  prefork {
    maxAge = "30 seconds"
    maxCount = 1
  }

  server {
    # TODO use HTTPS and WSS for communications between the Server and agents
    apiBaseUrl = "http://concord-server:{{ .Values.expose.port }}"
    websockerUrl = "ws://concord-server:{{ .Values.expose.port }}/websocket"
    readTimeout = "10 minutes"

    # TODO use a non-default API token
  }

  {{- if .Values.ccdMode }}
  docker {
    extraVolumes = [
        "/var/run/docker.sock:/var/run/docker.sock",
        "/tmp:/tmp",
        "/repo:/repo"
    ]
  }
  {{- end }}
}
